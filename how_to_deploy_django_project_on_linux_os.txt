Първоначално трябва да направим папка /envs на ниво mange.py
След това в папката правим файл с име .env

В него ще запишем конфигурацията на следните променливи зададени в settings.py

### За production environment ###

1. DEBUG=0
2. ALLOWED_HOSTS=" изброяваме хостовете със space "
3. SECRET_KEY=django-insecure-0kk32qzln4o46fav0u+y%%@*5f7!kr#m@8_!8rfiqjxi!^-5j-m
4. DB_NAME=natfa_reg_office
5. DB_USER=penka  # Името на user-a с който се логваме в postgesql базата
6. DB_PASSWORD=dolna # Паролата която сме задали за логин в базата
7. DB_HOST=Хоста на който се намира базата
8. DB_PORT=5432 # Порта на който слуша базата
9. STATIC_ROOT=Задава се пътя до папката в която ще се експортнат статичните файлове /app/static

След това във файла settings.py задаваме на съответните променливи стойности, които взимаме от OS:

Има два начина за взимане на стойност от os:

Единият е с os.environ.get('KEY', 'DEFAULT')
Другият е с os.getenv('KEY', 'DEFAULT')

1. DEBUG = bool(int(os.getenv('DEBUG', 0)))
2. ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', '').split()
3. SECRET_KEY = os.getenv('SECRET_KEY', None)
4. "NAME": os.getenv('DB_NAME', None)
5. "USER": os.getenv('DB_USER', None)
6. "PASSWORD": os.getenv('DB_PASSWORD', None)
7. "HOST": os.getenv(DB_HOST, None)
8. "PORT": os.getenv(DB_PORT, 5432)
9. STATIC_ROOT = os.getenv(STATIC_ROOT, None)

След като сме направили .env файл трябва да направим Dockerfile чрез който да build-нем docker image

Тъй като ще ползваме requirements.txt за инсталиране на необходимите пакети за стартиране на application-a
преди това трябва да инсталираме gunicorn и да го добавим във файла requirements.txt

pip install gunicorn && pip freeze > requirements.txt

Dockerfile има следното съдържание:

FROM python:3

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# / - root directory (c:\)
# WORKDIR /app -> mkdir /app && cd /app
WORKDIR /app

COPY requirements.txt /app/
# Result: /app/requirements.txt

RUN pip install -r requirements.txt

# COPY . /app/
COPY apps /app/apps
COPY core /app.core
COPY registry_office /app/registry_office
COPY static_files /app/static_files
COPY media_files /app/media_files
COPY templates /app/templates
COPY manage.py /app/
